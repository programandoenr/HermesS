{
  "hash": "bc34a1a30b409688cb57f04ba4be14a2",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Plotting invasive species distributions with alpha shapes and choropleth maps in Python\"\ndescription: |\n  Invasive and introduced species can expand quickly into new habitats, altering ecosystems. In this post we use Python's {galah}, {alphashape} and {GeoPandas} packages to visualise the growing distribution of *Rhinella marina* (cane toads) and the expanding range of *Pittisporum undulatum* in Australia.\nauthor:\n  - name: \"Caitlin Ramsay\"\n  - name: \"Amanda Buyan\"\n  - name: \"Dax Kellie\"\ndate: \"2023-04-28\"\ntitle-block-banner: \"#B8573E\"\ntoc: true\ntoc-location: left\ntoc-depth: 2\ncategories:\n  - Eukaryota\n  - Animalia\n  - Plantae\n  - Maps\n  - Python\nimage: images/cane-toad-map.png\nfreeze: true\n---\n\n<!-- remove metadata section -->\n\n<style>\n#title-block-header.quarto-title-block.default .quarto-title-meta {\n    display: none;\n}\n</style>\n\n\n<!-- Author card -->\n\n:::{.author-card}\n:::{.author-card-text style=\"white-space: nowrap;\"}\n\n#### Author\nCaitlin Ramsay  \n[Amanda Buyan](https://labs.ala.org.au/about/Buyan_Amanda/index.html)  \n[Dax Kellie](https://labs.ala.org.au/about/Kellie_Dax/index.html)  \n\n#### Date\n28 April 2023\n\n:::\n\n:::{.row-b layout-ncol=\"3\" style=\"margin-left: auto; margin-right: auto; margin-top: auto; margin-bottom: auto;\"}\n\n:::{.author-card-image style=\"width: auto; height: 120px; margin-right: auto;\"}\n<img src=\"https://raw.githubusercontent.com/AtlasOfLivingAustralia/ala-labs/main/images/people/caitlin.jpg\" style=\"object-fit: cover; border-radius: 50% !important; width: 140px;\"></img>\n\n:::\n\n:::{.author-card-image style=\"width: auto; height: 120px; margin-right: auto;\"}\n<img src=\"https://raw.githubusercontent.com/AtlasOfLivingAustralia/ala-labs/main/images/people/amanda.jpg\" style=\"object-fit: cover; border-radius: 50% !important; width: 140px;\"></img>\n\n:::\n\n:::{.author-card-image style=\"width: auto; height: 120px; margin-right: auto !important;\"}\n<img src=\"https://raw.githubusercontent.com/AtlasOfLivingAustralia/ala-labs/main/images/people/dax.jpg\" style=\"object-fit: cover; border-radius: 50% !important; width: 140px;\"></img>\n\n:::\n:::\n:::\n\n<!------------------------ Post starts here ------------------------>\n\n:::{.callout-tip}\n\n## Intern Post\n\n:::\nHumans' movement across the globe has led to the accidental, and sometimes deliberate, transportation of species beyond their native habitats. In Australia since European colonisation, [around 3,000 species have been introduced](https://cloud.gbif.org/griis/resource?r=griis-australia). \n\nWithin the last 200 years [over 100 native species have gone extinct](https://theconversation.com/invasive-species-are-australias-number-one-extinction-threat-116809), with invasive species labelled as affecting [82% (1,257 of 1,533) of Australia's threatened taxa in 2018](https://soe.dcceew.gov.au/overview/pressures/invasive-species-and-range-shifts#impacts-of-invasive-species). Since 1960, invasive species have cost the Australian economy [at least $390 billion in damages](https://theconversation.com/pest-plants-and-animals-cost-australia-around-25-billion-a-year-and-it-will-get-worse-164969), and are now considered a main driver of extinctions in native plants and animals. \n\nHowever, species from outside of Australia aren't the only ones that can encroach on other species' habitats. [Native Australian species can do it, too](https://phys.org/news/2021-08-australian-native-invasive-species.html). Thanks in part to human activity, changing temperatures and more frequent extreme weather events, some Australian species have established themselves in new areas outside of their native range. Although not as popularly discussed, Australian species that have become pests in new habitats can disrupt ecosystems much like internationally invasive species.\n\nIn this post, we will use Python and the [{galah} package](https://galah.ala.org.au/) to visualise how distributions of both international invasive species and native introduced pest species have shifted over time. To do this, we will use alpha shapes to visualise the distribution of *Rhinella marina* (Cane toads) since the 1930s and create a choropleth map to visualise the expanded habitat range of *Pittosporum undulatum*.\n\n# Invasive Species\n\n### Download data\n\nTo start, we will use the infamous example of the cane toad to illustrate how far an invasive species' distribution can spread each decade.\n\n:::{layout=\"[-1, 1, -1]\"}\n<img class=\"rounded\" src=\"https://ala-images.s3.ap-southeast-2.amazonaws.com/store/e/f/b/2/0dd84abb-041e-4868-93fb-7b120ab92bfe/original\"></img>\n:::\n::: {.figure-caption}\n[Rhinella marina (Isaac Clarey CC-BY-NC 4.0 (Int))](https://biocache.ala.org.au/occurrences/722881a9-aff8-40f9-af5d-fe6bea58743d)\n:::\n\nFirst load the required Python packages.\n\n::: {#75e143e1 .cell message='false' execution_count=1}\n``` {.python .cell-code}\nimport galah\nimport pandas as pd\nimport geopandas\nimport numpy as np\nfrom dateutil.parser import parse\nimport matplotlib.pyplot as plt\nimport matplotlib as mpl\nimport alphashape\nfrom flexitext import flexitext\n```\n:::\n\n\nNext, we will use the [{galah} package](https://galah.ala.org.au/Python/index.html) to download occurrence records of cane toads in Australia from the Atlas of Living Australia (ALA). You will need to first provide a registered email with the ALA using `galah.galah_config()` before retrieving records.\n\n\n\n::: {#17d48e29 .cell execution_count=3}\n``` {.python .cell-code}\n# Add registered email (register at ala.org.au)\ngalah.galah_config(email = \"your-email@email.com\")\ngalah.galah_config(data_profile=\"ALA\")\n```\n:::\n\n\n::: {#823e6bca .cell .column-page execution_count=4}\n``` {.python .cell-code}\ncane_toads = galah.atlas_occurrences(taxa = \"Rhinella marina\", use_data_profile = True)\ncane_toads.head(5)\n```\n\n::: {.cell-output .cell-output-display execution_count=28}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>decimalLatitude</th>\n      <th>decimalLongitude</th>\n      <th>eventDate</th>\n      <th>scientificName</th>\n      <th>taxonConceptID</th>\n      <th>recordID</th>\n      <th>dataResourceName</th>\n      <th>occurrenceStatus</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>-38.300000</td>\n      <td>145.000000</td>\n      <td>1990-04-23T00:00:00Z</td>\n      <td>Rhinella marina</td>\n      <td>https://biodiversity.org.au/afd/taxa/e79179f8-...</td>\n      <td>58772bea-1c61-4716-a453-f201e89fcc8d</td>\n      <td>Museums Victoria provider for OZCAM</td>\n      <td>PRESENT</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>-38.300000</td>\n      <td>145.000000</td>\n      <td>1990-07-21T00:00:00Z</td>\n      <td>Rhinella marina</td>\n      <td>https://biodiversity.org.au/afd/taxa/e79179f8-...</td>\n      <td>141f0b10-bdf2-4239-80e4-1b5167e1f76c</td>\n      <td>Museums Victoria provider for OZCAM</td>\n      <td>PRESENT</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>-37.820000</td>\n      <td>145.230000</td>\n      <td>1990-04-14T00:00:00Z</td>\n      <td>Rhinella marina</td>\n      <td>https://biodiversity.org.au/afd/taxa/e79179f8-...</td>\n      <td>f6d07eb2-4f8f-476e-a212-726b10a4a745</td>\n      <td>Museums Victoria provider for OZCAM</td>\n      <td>PRESENT</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>-36.431411</td>\n      <td>148.329322</td>\n      <td>2017-03-07T00:00:00Z</td>\n      <td>Rhinella marina</td>\n      <td>https://biodiversity.org.au/afd/taxa/e79179f8-...</td>\n      <td>549908bf-0b34-4227-9288-42a7fa52dabf</td>\n      <td>NSW BioNet Atlas</td>\n      <td>PRESENT</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>-36.250765</td>\n      <td>149.120224</td>\n      <td>2021-02-04T00:00:00Z</td>\n      <td>Rhinella marina</td>\n      <td>https://biodiversity.org.au/afd/taxa/e79179f8-...</td>\n      <td>ae36a792-f694-4a73-acfb-e56be564def6</td>\n      <td>NSW BioNet Atlas</td>\n      <td>PRESENT</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Clean data\n\nWe'll clean our data to ensure that there are no null or missing values in our coordinates and date fields. Because `galah.atlas_occurrences()` returns a Pandas dataframe, we have plenty of functions we can use to clean our data.\n\n::: {#c9216146 .cell execution_count=5}\n``` {.python .cell-code}\ncane_toads = cane_toads.dropna(subset=[\"eventDate\", \"decimalLatitude\", \"decimalLongitude\"])\n```\n:::\n\n\nWe want to map cane toad's distribution each decade in our final visualisation. However, the `eventDate` value for each record is formaatted as a string value `yyyy-mm-dd Thh:mm:ssZ`. Let's write our own function `convert_date_to_decade()` that extract the year from a date `string` and return its corresponding decade by rounding down to the nearest decade.\n\n::: {#6c47d183 .cell execution_count=6}\n``` {.python .cell-code}\ndef convert_date_to_decade(value):\n    date = parse(value)\n    return date.year - (date.year%10)\n```\n:::\n\n\nWe'll create our new `decade` column by mapping each record's date value in `eventDate` to its corresponding decade value.\n\n::: {#082bda7d .cell execution_count=7}\n``` {.python .cell-code}\ncane_toads[\"decade\"] = cane_toads[\"eventDate\"].map(convert_date_to_decade)\n```\n:::\n\n\n### Make Australia map\n\nNext, let's download a shapefile of Australia with state boundaries. The Australian Bureau of Statistics provides [digital boundary files](https://www.abs.gov.au/statistics/standards/australian-statistical-geography-standard-asgs-edition-3/jul2021-jun2026/access-and-downloads/digital-boundary-files) from which you can explore many other Australian shapefiles. Download the [States and Territories - 2021 - Shapefile](https://www.abs.gov.au/statistics/standards/australian-statistical-geography-standard-asgs-edition-3/jul2021-jun2026/access-and-downloads/digital-boundary-files/STE_2021_AUST_SHP_GDA2020.zip) a zip folder. Save the zip folder inside your working folder and then unzip it to access the `.shp` file inside.\n\n{`GeoPandas`} is a package that handles geospatial data in Python and can be used to load in shapefiles as `GeoPandas` dataframes. Let's test this out by plotting our Australian state boundary shapefile.\n\n::: {#3ea662ae .cell execution_count=8}\n``` {.python .cell-code}\nmpl.rcParams['figure.dpi'] = 1200 # generate a high resolution image\nstates = geopandas.read_file(\"Australia_state_boundaries/STE_2021_AUST_GDA2020.shp\")\nstates.plot(edgecolor = \"#5A5A5A\", linewidth = 0.5, facecolor = \"white\")\n```\n:::\n\n\n::: {#12ad06f2 .cell message='false' execution_count=9}\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-10-output-1.png){}\n:::\n:::\n\n\n### Generate alpha shapes\n\nAlpha shapes can be used to define and visualise the shape of a set of species occurrence points in space. They are useful because they can be generated on *data-deficient* species with few available observations, and without using environmental data or complex algorithms. Let's use alpha shapes to see how cane toads' distribution has changed each decade since they were introduced.\n\nFirst, we need to obtain a list of all decades with cane toad observations. We'll use the `decade` column from our `cane_toads` dataframe to group our observations.\n\n::: {#72b4487e .cell execution_count=10}\n``` {.python .cell-code}\ndecades = list(set(cane_toads[\"decade\"]))\n```\n:::\n\n\nWe will be using the [{`alphashape`} package](https://pypi.org/project/alphashape/) to create alpha shapes representing the cane toad distribution for each decade they have been observed. The  alphashape.alphashape() function requires two things:\n\n  1.  A set of observation coordinates\n  2.  An alpha parameter, which sets how tightly the shape’s lines conform to our observations\n    \nLet's make an alpha shape for each decade's observations. We'll also add a slight buffer to each alpha shape to smooth out some of its edges. Then we'll group all the shapes into one large `GeoPandas` dataframe.\n\n:::{.callout-note}\nWe used `alpha = 1`, but it's good practice to change this parameter depending on how widely distributed the coordinates of your data are. Also note that `alphashape.alphashape()` requires at least 3 data points to calculate an alpha shape.\n:::\n\n::: {#d24f7f2f .cell execution_count=11}\n``` {.python .cell-code}\nalpha_shape_gdf = geopandas.GeoDataFrame() # GeoPandas data frame to contain all alpha shapes\nfor i, d in enumerate(decades):\n    decade_points = cane_toads[[\"decimalLongitude\", \"decimalLatitude\"]] [cane_toads[\"decade\"] == d]\n    if len(decade_points) <= 3: \n        continue\n    alpha_shape = alphashape.alphashape(decade_points, 1)\n    d = {\"decade\": d, \"geometry\": [alpha_shape.buffer(0.2)]}\n    tmp_gdf = geopandas.GeoDataFrame(d, crs=\"EPSG:7844\")\n    alpha_shape_gdf = pd.concat([alpha_shape_gdf, tmp_gdf])\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWARNING:root:Singular matrix. Likely caused by all points lying in an N-1 space.\n```\n:::\n:::\n\n\nNext, let's clean up our `GeoPandas` dataframe so that it is ready for plotting! Sometimes the `alphashape.alphashape()` algorithm will produce an empty shape that needs to be removed from the dataframe (this generally happens when the chosen alpha parameter is not appropriate for the supplied set of points). Let's remove these shapes from our data.\n\n::: {#f5b90d42 .cell execution_count=12}\n``` {.python .cell-code}\nalpha_shape_gdf = alpha_shape_gdf[~alpha_shape_gdf[\"geometry\"].is_empty]\n```\n:::\n\n\nNow let's format our decade string to display correctly on the figure legend by making sure it's in `YYYYs` format.\n\n::: {#9e119838 .cell execution_count=13}\n``` {.python .cell-code}\nalpha_shape_gdf[\"decade_string\"] = alpha_shape_gdf[\"decade\"].map(lambda d: str(d) + \"s\")\n```\n:::\n\n\nFinally, because we expect cane toad distributions in earlier decades to be smaller than in recent decades, we'll need to plot earlier distributions *on top* of later distributions to avoid covering the earlier ones up. To achieve this, let's order the alpha shapes in descending order by decade.\n\n::: {#b7b78bf6 .cell execution_count=14}\n``` {.python .cell-code}\nalpha_shape_gdf.sort_values(by='decade', ascending=False, inplace=True)\n```\n:::\n\n\n### Map alpha shape distributions\n\nFinally, we can plot our alpha shape distributions for each decade onto our map of Australia!\n\nThis figure showcases the incredible pace of the cane toad's spread across northern Australia. Our map shows that cane toads have spread across most of Queensland, the top end of the Northern Territory (from the 1980s to 2010s) and more recently, into the Kimberley region of Western Australia.\n\n::: {#639f20d9 .cell .column-page fig-height='9' message='false' out-extra='style=margin-left:auto;margin-right:auto;' execution_count=15}\n``` {.python .cell-code}\nax = states.boundary.plot(edgecolor=\"#5A5A5A\", linewidth=0.5, facecolor=\"white\", zorder=-1)\n\nalpha_shape_gdf.plot(ax = ax, cmap=\"plasma\", column = \"decade_string\", legend=True, categorical=True)\nlgd = ax.get_legend()\nlgd.draw_frame(False)\nlgd.set_bbox_to_anchor((1.2, 0.8))\n\ntitle_text = \"<style: italic>Rhinella marina</> (cane toad) distributions per decade\"\nflexitext(0.5, 1, title_text, va=\"bottom\", ha=\"center\");\n\ncaption_text = \"<color:#5A5A5A, style:italic, size:7>Distributions calculated with alpha hulls of each decade's cane toad observations</>\"\nflexitext(0.05, 0, caption_text, va=\"top\");\n\nplt.xlim([110, 161])\nplt.ylim([-45, -8])\nplt.axis(\"off\")\nplt.subplots_adjust(left=-0.15, right=1)\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-16-output-1.png){fig-align='center'}\n:::\n:::\n\n\n### Other invasive species\n\nLet's use the same code as above to visualise other invasive species *Camelus dromedarius* (Feral dromedary camels) and *Echium plantagineum* (Paterson's curse).\n\n:::{.panel-tabset .nav-pills}\n\n#### Camels\n\n::: {#59401f90 .cell fig-height='7' out-extra='style=margin-left:auto;margin-right:auto;' execution_count=16}\n``` {.python .cell-code code-fold=\"true\"}\n# Camel\ncamels = galah.atlas_occurrences(\"Camelus dromedarius\", use_data_profile=\"ALA\")\ncamels = camels.dropna(subset=[\"eventDate\", \"decimalLatitude\", \"decimalLongitude\"])\ncamels[\"decade\"] = camels[\"eventDate\"].map(convert_date_to_decade)\ndecades = list(set(camels[\"decade\"]))\n\nalpha_shape_gdf = geopandas.GeoDataFrame() # GeoPandas data frame to contain all alpha shapes\n\nfor i, d in enumerate(decades):\n    decade_points = camels[[\"decimalLongitude\", \"decimalLatitude\"]] [camels[\"decade\"] == d]\n    if len(decade_points) <= 3: \n        continue\n    alpha_shape = alphashape.alphashape(decade_points, 1)\n    d = {\"decade\": d, \"geometry\": [alpha_shape.buffer(0.2)]}\n    tmp_gdf = geopandas.GeoDataFrame(d, crs=\"EPSG:4326\")\n    alpha_shape_gdf = pd.concat([alpha_shape_gdf, tmp_gdf])\n\nalpha_shape_gdf = alpha_shape_gdf[ ~alpha_shape_gdf[\"geometry\"].is_empty]\nalpha_shape_gdf[\"decade_string\"] = alpha_shape_gdf[\"decade\"].map(lambda d: str(d) + \"s\")\nalpha_shape_gdf.sort_values(by='decade', ascending=False, inplace=True)\n\nax = states.boundary.plot(edgecolor=\"#5A5A5A\", linewidth=0.5, facecolor=\"white\", zorder=-1)\n\nalpha_shape_gdf.plot(ax = ax, cmap=\"plasma\", column = \"decade\", legend=True, categorical=True)\nlgd = ax.get_legend()\nlgd.draw_frame(False)\nlgd.set_bbox_to_anchor((1.2, 0.61))\n\ntitle_text = \"<style: italic>Camelus dromedarius</> (dromedary camel) distributions per decade\"\nflexitext(0.5, 1, title_text, va=\"bottom\", ha=\"center\");\n\ncaption_text = \"<color:#5A5A5A, style:italic, size:7>Distributions calculated with alpha hulls of each decade's dromedary camel observations</>\"\nflexitext(0.05, 0, caption_text, va=\"top\");\n\nplt.xlim([110, 161])\nplt.ylim([-45, -8])\nplt.axis(\"off\")\nplt.subplots_adjust(left=-0.1, right=1)\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-17-output-1.png){fig-align='center'}\n:::\n:::\n\n\n#### Patterson's curse\n\n::: {#3eaf3f3d .cell fig-height='7' out-extra='style=margin-left:auto;margin-right:auto;' execution_count=17}\n``` {.python .cell-code code-fold=\"true\"}\n# Paterson's Curse\nopuntia = galah.atlas_occurrences(\"Echium plantagineum\", use_data_profile=\"ALA\")\nopuntia = opuntia.dropna(subset=[\"eventDate\", \"decimalLatitude\", \"decimalLongitude\"])\nopuntia[\"decade\"] = opuntia[\"eventDate\"].map(convert_date_to_decade)\ndecades = list(set(opuntia[\"decade\"]))\n\nalpha_shape_gdf = geopandas.GeoDataFrame() # GeoPandas data frame to contain all alpha shapes\n\nfor i, d in enumerate(decades):\n    decade_points = opuntia[[\"decimalLongitude\", \"decimalLatitude\"]] [opuntia[\"decade\"] == d]\n    if len(decade_points) <= 3: \n        continue\n    alpha_shape = alphashape.alphashape(decade_points, 1)\n    d = {\"decade\": d, \"geometry\": [alpha_shape.buffer(0.2)]}\n    tmp_gdf = geopandas.GeoDataFrame(d, crs=\"EPSG:4326\")\n    alpha_shape_gdf = pd.concat([alpha_shape_gdf, tmp_gdf])\n\nalpha_shape_gdf = alpha_shape_gdf[ ~alpha_shape_gdf[\"geometry\"].is_empty]\nalpha_shape_gdf[\"decade_string\"] = alpha_shape_gdf[\"decade\"].map(lambda d: str(d) + \"s\")\nalpha_shape_gdf.sort_values(by='decade', ascending=False, inplace=True)\n\nax = states.boundary.plot(edgecolor=\"#5A5A5A\", linewidth=0.5, facecolor=\"white\", zorder=-1)\n\nalpha_shape_gdf.plot(ax = ax, cmap=\"plasma\", column = \"decade\", legend=True, categorical=True)\nlgd = ax.get_legend()\nlgd.draw_frame(False)\nlgd.set_bbox_to_anchor((1.2, 0.85))\n\ntitle_text = \"<style: italic>Echium plantagineum</> (Paterson's curse) distributions per decade\"\nflexitext(0.5, 1, title_text, va=\"bottom\", ha=\"center\");\n\ncaption_text = \"<color:#5A5A5A, style:italic, size:7>Distributions calculated with alpha hulls of each decade's Paterson's curse observations</>\"\nflexitext(0.05, 0, caption_text, va=\"top\");\n\nplt.xlim([110, 161])\nplt.ylim([-45, -8])\nplt.axis(\"off\")\nplt.subplots_adjust(left=-0.1, right=1)\n\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-18-output-1.png){fig-align='center'}\n:::\n:::\n\n\n:::\n\n# Native introduced pest species\n\nWhen people think of invasive species, they generally think of species that have been introduced to Australia from other countries. However, even Australia's native species can become pests when introduced to a new ecosystem. \n\nOne good example of native pests are the trees *Pittosporum undulatum* (sometimes called Sweet Pittosporum). These trees have been introduced as ornamental plants in gardens across Australia because of their sweet-scented flowers and bright berries. Although *Pittosporum undulatum*'s native range extends from southern Queensland to eastern Victoria, it is now considered an environmental weed in many regions where it has been introduced.\n\n:::{layout=\"[-1, 1, -1]\"}\n<img class=\"rounded\" src=\"https://ala-images.s3.ap-southeast-2.amazonaws.com/store/9/9/e/b/3765267a-f11a-474f-9bc9-215a5394be99/original\"></img>\n:::\n::: {.figure-caption}\n[Pittosporum undulatum (Chris Clarke CC-BY)](https://biocache.ala.org.au/occurrences/30b0b6dc-1d77-4a1f-ae15-18ef5ef67e28)\n:::\n\nLet's create a choropleth map to visualise the to visualise the bioregions where *Pittosporum undulatum* is native and introduced.\n\n\n### Download IBRA regions\n\nFirst, let's download a shapefile of Australia's bioregions. The [IBRA7 bioregions](https://data.gov.au/dataset/ds-dga-d44dd392-ebea-4f1a-b30e-4a2da154aae4/details?q=ibra) classify areas within Australia that are geographically and ecologically distinct. Download the zip folder, save it in your project directory and unzip it. We can again use the {GeoPandas} package to read in and handle these data.\n\n::: {#57319588 .cell execution_count=18}\n``` {.python .cell-code}\nbioregions = geopandas.read_file(\"IBRA7_regions/ibra7_regions.shp\")\nbioregions.plot(edgecolor = \"#5A5A5A\", linewidth = 0.25, facecolor = \"white\")\n```\n:::\n\n\n::: {#51c7d058 .cell message='false' execution_count=19}\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-20-output-1.png){}\n:::\n:::\n\n\nWithin our `bioregions` dataframe, the column `REG_NAME_7` contains IBRA bioregion names.\n\n::: {#3ae772e0 .cell .column-page execution_count=20}\n``` {.python .cell-code}\nbioregions.head(5)\n```\n\n::: {.cell-output .cell-output-display execution_count=42}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>REG_CODE_7</th>\n      <th>REG_NAME_7</th>\n      <th>HECTARES</th>\n      <th>SQ_KM</th>\n      <th>REC_ID</th>\n      <th>REG_CODE_6</th>\n      <th>REG_NAME_6</th>\n      <th>REG_NO_61</th>\n      <th>FEAT_ID</th>\n      <th>Shape_Leng</th>\n      <th>Shape_Area</th>\n      <th>geometry</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>ARC</td>\n      <td>Arnhem Coast</td>\n      <td>3.335669e+06</td>\n      <td>33356.686</td>\n      <td>1</td>\n      <td>ARC</td>\n      <td>Arnhem Coast</td>\n      <td>81.0</td>\n      <td>GA_100K_Islands</td>\n      <td>52.135362</td>\n      <td>2.774143</td>\n      <td>MULTIPOLYGON (((136.93863 -14.36548, 136.93790...</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>ARP</td>\n      <td>Arnhem Plateau</td>\n      <td>2.306023e+06</td>\n      <td>23060.226</td>\n      <td>2</td>\n      <td>ARP</td>\n      <td>Arnhem Plateau</td>\n      <td>82.0</td>\n      <td>GA_100K_Mainland</td>\n      <td>8.206764</td>\n      <td>1.921833</td>\n      <td>POLYGON ((134.08186 -12.32124, 134.09525 -12.3...</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>AUA</td>\n      <td>Australian Alps</td>\n      <td>1.232981e+06</td>\n      <td>12329.805</td>\n      <td>3</td>\n      <td>AA</td>\n      <td>Australian Alps</td>\n      <td>6.0</td>\n      <td>GA_100K_Mainland</td>\n      <td>63.337626</td>\n      <td>1.242821</td>\n      <td>MULTIPOLYGON (((145.75905 -37.67486, 145.76034...</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>AVW</td>\n      <td>Avon Wheatbelt</td>\n      <td>9.517104e+06</td>\n      <td>95171.043</td>\n      <td>4</td>\n      <td>AW</td>\n      <td>Avon Wheatbelt</td>\n      <td>70.0</td>\n      <td>GA_100K_Mainland</td>\n      <td>35.275357</td>\n      <td>9.012298</td>\n      <td>POLYGON ((115.48396 -28.30698, 115.48428 -28.3...</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>BBN</td>\n      <td>Brigalow Belt North</td>\n      <td>1.367453e+07</td>\n      <td>136745.325</td>\n      <td>5</td>\n      <td>BBN</td>\n      <td>Brigalow Belt North</td>\n      <td>22.0</td>\n      <td>GA_100K_Islands</td>\n      <td>91.288203</td>\n      <td>11.986228</td>\n      <td>MULTIPOLYGON (((151.14295 -23.71304, 151.14210...</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Find bioregions with observations\n\nWe'll once again use {galah} to find numbers of *Pittosporum undulatum* in each bioregion. First, let's find which field ID corresponds to bioregions in {galah}\n\n::: {#e0b69074 .cell execution_count=21}\n``` {.python .cell-code}\ngalah.search_all(fields = \"IBRA\") \n```\n\n::: {.cell-output .cell-output-display execution_count=43}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>description</th>\n      <th>type</th>\n      <th>link</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>cl3</td>\n      <td>Western Australian Biodiversity Science Resear...</td>\n      <td>layers</td>\n      <td></td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>cl20</td>\n      <td>IBRA 6 Regions Interim Biogeographic Regionali...</td>\n      <td>layers</td>\n      <td></td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>cl1049</td>\n      <td>IBRA 7 Subregions IBRA 7 Subregions</td>\n      <td>layers</td>\n      <td></td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>cl1048</td>\n      <td>IBRA 7 Regions Interim Biogeographic Regionali...</td>\n      <td>layers</td>\n      <td></td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nIt looks like field `cl1048` contains IBRA 7 regions. Let's check what values this field contains by using `galah.show_values()`.\n\n::: {#6400dd42 .cell execution_count=22}\n``` {.python .cell-code}\ngalah.show_values(field = \"cl1048\")\n```\n\n::: {.cell-output .cell-output-display execution_count=44}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>field</th>\n      <th>category</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>cl1048</td>\n      <td>South Eastern Queensland</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>cl1048</td>\n      <td>Sydney Basin</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>cl1048</td>\n      <td>South Eastern Highlands</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>cl1048</td>\n      <td>South East Coastal Plain</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>cl1048</td>\n      <td>NSW North Coast</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>84</th>\n      <td>cl1048</td>\n      <td>Central Arnhem</td>\n    </tr>\n    <tr>\n      <th>85</th>\n      <td>cl1048</td>\n      <td>Indian Tropical Islands</td>\n    </tr>\n    <tr>\n      <th>86</th>\n      <td>cl1048</td>\n      <td>Little Sandy Desert</td>\n    </tr>\n    <tr>\n      <th>87</th>\n      <td>cl1048</td>\n      <td>Gibson Desert</td>\n    </tr>\n    <tr>\n      <th>88</th>\n      <td>cl1048</td>\n      <td>Coral Sea</td>\n    </tr>\n  </tbody>\n</table>\n<p>89 rows × 2 columns</p>\n</div>\n```\n:::\n:::\n\n\nNow we can use the `group_by` argument in `galah.atlas_counts()` to group observations of *Pittosporum undulatum* by bioregion, returning all bioregions where *Pittosporum undulatum* has been observed at least once. We'll extract extract and save the bioregion names in a dataframe.\n\n::: {#2418e7be .cell execution_count=23}\n``` {.python .cell-code}\nfound_bioregion_counts = galah.atlas_counts(\"Pittosporum undulatum\",\n                                           group_by=\"cl1048\",\n                                           expand = False)\n\n# extract bioregion names from Pandas dataframe into list\nfound_bioregions = list(found_bioregion_counts[\"cl1048\"])\n\nprint(found_bioregion_counts[0:10])\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     cl1048  count\n0              Sydney Basin  10244\n1  South East Coastal Plain   3300\n2   South Eastern Highlands   2945\n3         South East Corner   2931\n4           NSW North Coast   2445\n5  South Eastern Queensland   1190\n6      Flinders Lofty Block    464\n7   Southern Volcanic Plain    368\n8        Victorian Midlands    200\n9       Brigalow Belt South    173\n```\n:::\n:::\n\n\n### Separate native & introduced regions\n\nNext, let's separate bioregions where *Pittosporum undulatum* is native from bioregions where it has been introduced. The Australia Native Plants Society estimates *Pittosporum undulatum*'s native range overlapping with South Eastern Queensland, NSW North Coast, Sydney Basin, South East Corner and South East Coastal Plain (see [here](https://anpsa.org.au/plant_profiles/pittosporum-undulatum/)). Let's save these bioregion names in a separate dataframe and compare them to the overall list `found_bioregions`.\n\n::: {#563edd6e .cell execution_count=24}\n``` {.python .cell-code}\nnative_bioregions = [\"South Eastern Queensland\", \"NSW North Coast\", \"Sydney Basin\", \"South East Corner\", \"South East Coastal Plain\"]\nintroduced_bioregions = [region for region in found_bioregions if region not in native_bioregions]\n\nprint(introduced_bioregions[1:5]) # first 5 introduced regions\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n['Flinders Lofty Block', 'Southern Volcanic Plain', 'Victorian Midlands', 'Brigalow Belt South']\n```\n:::\n:::\n\n\nNext we can add a new column `native` to our GeoPandas bioregion dataframe to identify native and introduced regions. We'll use the `.loc` method to assign a \"Native\", \"Introduced\" or \"No observations\" label to each row depending on whether the region is in `native_bioregions` or `introduced_bioregions`.\n\n::: {#97b77a5d .cell execution_count=25}\n``` {.python .cell-code}\nbioregions.loc[bioregions[\"REG_NAME_7\"].isin(native_bioregions), \"native\"] = \"Native\"\nbioregions.loc[bioregions[\"REG_NAME_7\"].isin(introduced_bioregions), \"native\"] = \"Introduced\"\nbioregions[\"native\"] = bioregions[\"native\"].replace(\"nan\", \"No observations\")\n```\n:::\n\n\n### Make choropleth map\n\nWhen plotting this GeoPandas dataframe, we can specify that we want the map coloured according to its `native` label so that native, introduced and not found bioregions are distinguishable colours. This is done by supplying the `column` argument of the `.plot()` function with the column of the dataframe that the colouring is based upon. However, `matplotlib` would choose a default colourmap to colour the bioregions so we will need to specify the exact colours we wanted associated with each type of bioregion. \n\nTo identify our three categories of regions on our map, we'll create a new column `colour` containing colour hex codes for plotting our regions.\n\n::: {#67949bfb .cell execution_count=26}\n``` {.python .cell-code}\nbioregions.loc[bioregions[\"native\"] == \"Native\", \"colour\"] = \"#8FBD4C\" # Native\nbioregions.loc[bioregions[\"native\"] == \"Introduced\", \"colour\"] = \"#F7872E\" # Introduced\nbioregions.loc[bioregions[\"native\"] == \"No observations\", \"colour\"] = \"#E4DFCF\" # No observations\n```\n:::\n\n\nWe can use this `colour` column as the input to our `.plot()` function.\n\nOur map shows that *Pittosporum undulatum* has been observed in Western Australia, Northern Territory, South Australia, and even Tasmania despite having a fairly narrow native range along the east coast of Australia.\n\n::: {#97e253e3 .cell .column-page fig-height='9' out-extra='style=margin-left:auto;margin-right:auto;' execution_count=27}\n``` {.python .cell-code}\nbioregions.plot(edgecolor=\"white\", linewidth = 0.25, color = bioregions[\"colour\"])\n\ntitle_text = \"<style:italic>Pittosporum undulatum</> <color:#8FBD4C, weight:bold>native</> and <color:#F7872E, weight:bold>introduced</> Australian bioregions\"\nflexitext(0.5, 1, title_text, va=\"bottom\", ha=\"center\");\n\nplt.xlim([110, 161])\nplt.ylim([-45, -8])\nplt.axis(\"off\")\nplt.show()\n```\n\n::: {.cell-output .cell-output-display}\n![](index_files/figure-html/cell-28-output-1.png){fig-align='center'}\n:::\n:::\n\n\n# Final thoughts\n\nHuman activity—from constructing buildings to travelling overseas to gardening—plays a part in shaping modern ecosystems. Our maps showed how quickly well-known invasive species have established themselves across Australia, and how widely even native Australian plants can spread when introduced to non-native regions.\n\nHumans are just one of many drivers of introducing species to new areas. Changes to the environment, for example, can shrink available resources and living space in a habitat, giving introduced species a chance to outcompete native species for what resources and space are left. [As species inevitably enter and alter ecosystems](https://soe.dcceew.gov.au/overview/pressures/invasive-species-and-range-shifts#range-shifts-and-extensions), large weather events, extreme temperatures and habitat degradation [can give invasives a big leg-up on the native competition, too](https://theconversation.com/research-reveals-fire-is-pushing-88-of-australias-threatened-land-mammals-closer-to-extinction-185965). \n\nNonetheless, there is still hope. Research finds [native species can still adapt to changing environments](https://www.ecolsoc.org.au/news/native-plants-are-taking-back-their-homes/) and simple tasks like [pulling weeds](https://theconversation.com/pulling-out-weeds-is-the-best-thing-you-can-do-to-help-nature-recover-from-the-fires-130296) can help native species survive after events like fires.\n\n<details><summary style = \"color: #E06E53;\">Expand for session info</summary>\n\n::: {#dabd9708 .cell execution_count=28}\n``` {.python .cell-code}\nimport math\nimport natsort\nimport pandas\nimport session_info\n\nsession_info.show()\n```\n\n::: {.cell-output .cell-output-display execution_count=50}\n```{=html}\n<details>\n<summary>Click to view session information</summary>\n<pre>\n-----\nalphashape          1.3.1\ndateutil            2.8.2\nflexitext           0.2.0\ngalah               0.8.2\ngeopandas           0.14.1\nmatplotlib          3.8.2\nnatsort             8.4.0\nnumpy               1.26.2\npandas              2.1.3\nsession_info        1.0.0\nshapely             2.0.2\n-----\n</pre>\n<details>\n<summary>Click to view modules imported as dependencies</summary>\n<pre>\nPIL                 10.1.0\nasttokens           NA\nattr                23.1.0\ncertifi             2023.11.17\ncffi                1.15.1\ncharset_normalizer  3.3.2\ncolorama            0.4.6\ncomm                0.2.0\ncycler              0.12.1\ncython_runtime      NA\ndebugpy             1.8.0\ndecorator           5.1.1\ndefusedxml          0.7.1\nexecuting           2.0.1\nfiona               1.9.5\ngoogle              NA\nidna                3.6\nipykernel           6.27.0\nipython_genutils    0.2.0\njedi                0.19.1\nkiwisolver          1.4.5\nmatplotlib_inline   0.1.6\nmpl_toolkits        NA\nnetworkx            3.2.1\npackaging           23.2\nparso               0.8.3\npickleshare         0.7.5\npkg_resources       NA\nplatformdirs        4.1.0\nprompt_toolkit      3.0.41\npsutil              5.9.6\npure_eval           0.2.2\npydev_ipython       NA\npydevconsole        NA\npydevd              2.9.5\npydevd_file_utils   NA\npydevd_plugins      NA\npydevd_tracing      NA\npygments            2.17.2\npyparsing           3.1.1\npyproj              3.6.1\npytz                2023.3.post1\npywin32_bootstrap   NA\npywin32_system32    NA\nrequests            2.31.0\nrtree               1.0.1\nscipy               1.12.0\nsix                 1.16.0\nstack_data          0.6.3\ntornado             6.3.3\ntraitlets           5.13.0\ntrimesh             3.21.5\nurllib3             2.1.0\nwcwidth             0.2.12\nzmq                 25.1.2\n</pre>\n</details> <!-- seems like this ends pre, so might as well be explicit -->\n<pre>\n-----\nIPython             8.17.2\njupyter_client      8.6.0\njupyter_core        5.5.0\nnotebook            6.5.4\n-----\nPython 3.12.0 (tags/v3.12.0:0fb18b0, Oct  2 2023, 13:03:39) [MSC v.1935 64 bit (AMD64)]\nWindows-10-10.0.19045-SP0\n-----\nSession information updated at 2024-02-13 11:25\n</pre>\n</details>\n```\n:::\n:::\n\n\n</details>\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}