{
  "hash": "9ebf2daca89874a916de4c8e4b60a79b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Download a species list and cross-reference with conservation status lists\"\ndescription: |\n  Knowing what species have been observed in a local area is a regular task for ecosystem management. Here we show how to make a species list with {galah-python} and how to cross-reference this list with threatened and sensitive species lists. We then show how to visualise this information as a waffle chart using {pywaffle} & {matplotlib}.\nauthor:\n  - name: \"Amanda Buyan\"\n  - name: \"Dax Kellie\"\ndate: \"2024-02-12\"\ntitle-block-banner: \"#B8573E\"\ntoc: true\ntoc-location: left\ntoc-depth: 2\ncategories:\n  - Eukaryota\n  - Summaries\n  - Python\nimage: waffle-chart.png\nfreeze: true\nengine: knitr\njupyter: python3\neditor_options: \n  chunk_output_type: console\n---\n\n\n\n\n<!-- remove metadata section -->\n<style>\n  #title-block-header.quarto-title-block.default .quarto-title-meta {\n      display: none;\n  }\n</style>\n\n\n\n<!-- Author card -->\n\n:::{.author-card}\n:::{.author-card-text}\n\n#### Author\n[Amanda Buyan](https://labs.ala.org.au/people/Buyan_Amanda/index.html)  \n[Dax Kellie](https://labs.ala.org.au/people/Kellie_Dax/index.html)  \n\n#### Date\n12 February 2024\n\n:::\n\n:::{.author-card-image}\n\n::: {.cell}\n::: {.cell-output-display}\n![](https://raw.githubusercontent.com/AtlasOfLivingAustralia/ala-labs/main/images/people/amanda.jpg){width=120px style=\"clip-path: circle();\"}\n:::\n:::\n\n:::\n\n:::{.author-card-image}\n\n::: {.cell}\n::: {.cell-output-display}\n![](https://raw.githubusercontent.com/AtlasOfLivingAustralia/ala-labs/main/images/people/dax.jpg){width=120px style=\"clip-path: circle();\"}\n:::\n:::\n\n:::\n\n:::\n\n<!------------------------ Post starts here ------------------------>\n\nKnowing what species inhabit an area is important for conservation and ecosystem management. In particular, it can help us find out how many known species are in a given area, whether each species is common or rare, and whether any species are threatened or endangered.\n\nIn this post, we will use the `galah-python`, `geopandas`, `matplotlib` and `pywaffle` packages to show you how to download a list of species within the Yass Valley in 2023, cross-reference this list with state-wide conservation status lists, and visualise the number of threatened and sensitive species in the region. \n\n# Download a list of species\n\nThere are two ways to narrow a download query to return information for a specific region:  \n\n  * Using fields available in `galah-python` (downloaded from the ALA)\n  * Using a shapefile\n  \nThe method you choose depends on whether the region you wish to return species for is already within `galah-python`, or whether you require a list for a more specific area defined by a shapefile.\n\n::: {.panel-tabset .nav-pills}\n\n# Fields in galah\n\n\n::: {.cell}\n\n:::\n\n\n## Search for fields in galah\n\nTo find which fields and layers exist within `galah-python` to help us narrow our query, we can use the `search_all()` function. Let's do a text search to find what fields contain information on \"Local Government Areas\".\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport galah\nimport geopandas as gpd\ngalah.search_all(fields=\"Local Government Areas\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        id                                        description    type link\n0     cl23  Local Government Areas 2012 deprecated LGA Bou...  layers     \n1    cl959  Local Government Areas 2011 Local Government A...  layers     \n2   cl2012  NSW Local Land Services Regions NSW Local Land...  layers     \n3  cl10923  Local Government Areas PSMA 2018 Local Governm...  layers     \n```\n\n\n:::\n:::\n\n\nThe field `cl10923`[^1] appears to contain the most recent data (from 2018). We can preview what values are *within* the field `cl10923` using `show_values()`.\n\n\n::: {.cell}\n\n```{.python .cell-code}\ngalah.show_values(field=\"cl10923\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       field                      category\n0    cl10923                 BRISBANE CITY\n1    cl10923          EAST GIPPSLAND SHIRE\n2    cl10923          GREATER GEELONG CITY\n3    cl10923  PASTORAL UNINCORPORATED AREA\n4    cl10923          MORETON BAY REGIONAL\n..       ...                           ...\n555  cl10923                  WAGAIT SHIRE\n556  cl10923   WOORABINDA ABORIGINAL SHIRE\n557  cl10923  WUJAL WUJAL ABORIGINAL SHIRE\n558  cl10923    CHERBOURG ABORIGINAL SHIRE\n559  cl10923                 BELYUEN SHIRE\n\n[560 rows x 2 columns]\n```\n\n\n:::\n:::\n\n\nThere are lots Local Government Areas! To check that Yass Valley is included, we can do another text search for values that match \"YASS VALLEY\".\n\n[^1]: Each spatial layer has a two letter code, along with a number to identify it. The abbreviations are as follows:\n  * `cl` = contextual layer (i.e. boundaries of LGAs, Indigenous Protected Areas, States/Territories etc.)  \n  * `10923` = number associated with the spatial layer in the atlas\n\n\n::: {.cell}\n\n```{.python .cell-code}\ngalah.search_values(field=\"cl10923\", value = \"YASS VALLEY\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     field             category\n0  cl10923  YASS VALLEY COUNCIL\n```\n\n\n:::\n:::\n\n\n## Download data\n\nUsing the `field` and `category` above, we can now build our query. We can use `atlas_species()` to return a species list, and use the `filters` argument to narrow our query. To add the observation count for each species, add `counts=True`.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nspecies_yass = galah.atlas_species(\n  filters=[\"cl10923=YASS VALLEY COUNCIL\", \"year=2023\"],\n  counts=True\n)\nspecies_yass\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                                Species                       Species Name Scientific Name Authorship Taxon Rank   Kingdom      Phylum          Class           Order        Family        Genus               Vernacular Name  Number of records\n0     https://biodiversity.org.au/afd/taxa/5291343e-...                 Gymnorhina tibicen             (Latham, 1801)    species  Animalia    Chordata           Aves   Passeriformes     Artamidae   Gymnorhina             Australian Magpie                334\n1     https://biodiversity.org.au/afd/taxa/97a59c84-...    Rhipidura (Rhipidura) albiscapa                Gould, 1840    species  Animalia    Chordata           Aves   Passeriformes  Rhipiduridae    Rhipidura                  Grey Fantail                253\n2     https://biodiversity.org.au/afd/taxa/760401df-...          Malurus (Malurus) cyaneus              (Ellis, 1782)    species  Animalia    Chordata           Aves   Passeriformes     Maluridae      Malurus             Superb Fairy-wren                251\n3     https://biodiversity.org.au/afd/taxa/2c33a1fd-...         Cacatua (Cacatua) galerita             (Latham, 1790)    species  Animalia    Chordata           Aves  Psittaciformes    Cacatuidae      Cacatua      Sulphur-crested Cockatoo                239\n4     https://biodiversity.org.au/afd/taxa/5e0f496f-...  Platycercus (Platycercus) elegans             (Gmelin, 1788)    species  Animalia    Chordata           Aves  Psittaciformes   Psittacidae  Platycercus               Crimson Rosella                204\n...                                                 ...                                ...                        ...        ...       ...         ...            ...             ...           ...          ...                           ...                ...\n1107  https://id.biodiversity.org.au/taxon/apni/5141...                Pterostylis jonesii                 G.N.Backh.    species   Plantae  Charophyta  Equisetopsida     Asparagales   Orchidaceae  Pterostylis                           NaN                  1\n1108  https://id.biodiversity.org.au/taxon/apni/5141...             Pterostylis multiflora     (D.L.Jones) G.N.Backh.    species   Plantae  Charophyta  Equisetopsida     Asparagales   Orchidaceae  Pterostylis  Mountain Brown-tip Greenhood                  1\n1109  https://id.biodiversity.org.au/taxon/apni/5141...            Pterostylis pedunculata                      R.Br.    species   Plantae  Charophyta  Equisetopsida     Asparagales   Orchidaceae  Pterostylis                    Maroonhood                  1\n1110  https://id.biodiversity.org.au/taxon/apni/5141...                Thelymitra ixioides                        Sw.    species   Plantae  Charophyta  Equisetopsida     Asparagales   Orchidaceae   Thelymitra             Dotted Sun Orchid                  1\n1111  https://id.biodiversity.org.au/taxon/ausmoss/1...                 Thuidiopsis sparsa  (Hook.f. & Wilson) Broth.    species   Plantae   Bryophyta      Bryopsida        Hypnales   Thuidiaceae  Thuidiopsis                           NaN                  1\n\n[1112 rows x 12 columns]\n```\n\n\n:::\n:::\n\n\n# External shapefile\n\n## Download shapefile\n\nTo retrieve the spatial outline of Yass Valley, let's download the latest Local Government Areas data from the [Australian Bureau of Statistics Digital Boundary files page](https://www.abs.gov.au/statistics/standards/australian-statistical-geography-standard-asgs-edition-3/jul2021-jun2026/access-and-downloads/digital-boundary-files). Find \"Local Government Areas - 2023 - Shapefile\" and click \"Download ZIP\". Save the zip folder in your current directory and unzip it.\n\nWe'll use `read_file()` from `geopandas` to load our shapefile.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nLGAs_2023 = gpd.read_file(\"LGA_2023_AUST_GDA2020.shp\")\nLGAs_2023\n```\n:::\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n    LGA_CODE23                             LGA_NAME23 STE_CODE21                    STE_NAME21 AUS_CODE21         AUS_NAME21    AREASQKM                                         LOCI_URI21                                           geometry\n0        10050                                 Albury          1               New South Wales        AUS          Australia    305.6386  https://linked.data.gov.au/dataset/asgsed3/LGA...  POLYGON ((146.86566 -36.07292, 146.86512 -36.0...\n1        10180                               Armidale          1               New South Wales        AUS          Australia   7809.4406  https://linked.data.gov.au/dataset/asgsed3/LGA...  POLYGON ((152.38816 -30.52639, 152.38812 -30.5...\n2        10250                                Ballina          1               New South Wales        AUS          Australia    484.9692  https://linked.data.gov.au/dataset/asgsed3/LGA...  MULTIPOLYGON (((153.57106 -28.87381, 153.57106...\n3        10300                              Balranald          1               New South Wales        AUS          Australia  21690.7493  https://linked.data.gov.au/dataset/asgsed3/LGA...  POLYGON ((143.00433 -33.78164, 143.01538 -33.7...\n4        10470                               Bathurst          1               New South Wales        AUS          Australia   3817.8645  https://linked.data.gov.au/dataset/asgsed3/LGA...  POLYGON ((149.84877 -33.52784, 149.84864 -33.5...\n..         ...                                    ...        ...                           ...        ...                ...         ...                                                ...                                                ...\n561      89799  Migratory - Offshore - Shipping (ACT)          8  Australian Capital Territory        AUS          Australia         NaN  https://linked.data.gov.au/dataset/asgsed3/LGA...                                               None\n562      99399            Unincorp. Other Territories          9             Other Territories        AUS          Australia    105.8806  https://linked.data.gov.au/dataset/asgsed3/LGA...  MULTIPOLYGON (((167.94747 -29.12757, 167.94748...\n563      99499                  No usual address (OT)          9             Other Territories        AUS          Australia         NaN  https://linked.data.gov.au/dataset/asgsed3/LGA...                                               None\n564      99799   Migratory - Offshore - Shipping (OT)          9             Other Territories        AUS          Australia         NaN  https://linked.data.gov.au/dataset/asgsed3/LGA...                                               None\n565      ZZZZZ                      Outside Australia          Z             Outside Australia        ZZZ  Outside Australia         NaN  https://linked.data.gov.au/dataset/asgsed3/LGA...                                               None\n\n[566 rows x 9 columns]\n```\n\n\n:::\n:::\n\n\nNow let's use `to_crs()` to set the Coordinate Reference System (CRS) of our shapefile to [EPSG](https://en.wikipedia.org/wiki/EPSG_Geodetic_Parameter_Dataset):4326 (the standard used in cartography and GPS, also known as [WGS84](https://en.wikipedia.org/wiki/World_Geodetic_System)) so that it matches the projection of our data from the ALA [^2]. \n\n[^2]: Check out [this post](https://labs.ala.org.au/posts/2023-12-18_beginners-guide-make-a-map/post.html#make-a-map) for a better explanation of what CRS is and how it affects maps.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nLGAs_2023 = LGAs_2023.to_crs(4326)\n```\n:::\n\n\nNext we can filter our shapefile to only Yass Valley. The column `LGA_NAME23` contains area names, and we can filter our `Dataframe` to only rows where `LGA_NAME23` is equal to `Yass Valley`. We are left with a single polygon shape of Yass Valley.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nyass_valley = LGAs_2023[LGAs_2023['LGA_NAME23'] == \"Yass Valley\"]\nyass_valley[\"geometry\"]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n127    POLYGON ((148.58152 -34.80679, 148.58153 -34.8...\nName: geometry, dtype: geometry\n```\n\n\n:::\n:::\n\n\n## Download data\n\nNow that `yass_valley` contains our LGA shape, we can build our query. We can use `atlas_species()` to return a species list, passing our shape to the `polygon` argument of `atlas_species()` and specifying the year to `filters`. To add the observation count for each species, add `counts=True`.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nspecies_yass = galah.atlas_species(\n  polygon=yass_valley[\"geometry\"][127],\n  filters=\"year=2023\",\n  counts=True\n  )\nspecies_yass\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                                Species                       Species Name Scientific Name Authorship Taxon Rank   Kingdom      Phylum          Class           Order        Family        Genus               Vernacular Name  Number of records\n0     https://biodiversity.org.au/afd/taxa/5291343e-...                 Gymnorhina tibicen             (Latham, 1801)    species  Animalia    Chordata           Aves   Passeriformes     Artamidae   Gymnorhina             Australian Magpie                440\n1     https://biodiversity.org.au/afd/taxa/760401df-...          Malurus (Malurus) cyaneus              (Ellis, 1782)    species  Animalia    Chordata           Aves   Passeriformes     Maluridae      Malurus             Superb Fairy-wren                361\n2     https://biodiversity.org.au/afd/taxa/2c33a1fd-...         Cacatua (Cacatua) galerita             (Latham, 1790)    species  Animalia    Chordata           Aves  Psittaciformes    Cacatuidae      Cacatua      Sulphur-crested Cockatoo                304\n3     https://biodiversity.org.au/afd/taxa/97a59c84-...    Rhipidura (Rhipidura) albiscapa                Gould, 1840    species  Animalia    Chordata           Aves   Passeriformes  Rhipiduridae    Rhipidura                  Grey Fantail                296\n4     https://biodiversity.org.au/afd/taxa/5e0f496f-...  Platycercus (Platycercus) elegans             (Gmelin, 1788)    species  Animalia    Chordata           Aves  Psittaciformes   Psittacidae  Platycercus               Crimson Rosella                258\n...                                                 ...                                ...                        ...        ...       ...         ...            ...             ...           ...          ...                           ...                ...\n1177  https://id.biodiversity.org.au/taxon/apni/5141...                Pterostylis jonesii                 G.N.Backh.    species   Plantae  Charophyta  Equisetopsida     Asparagales   Orchidaceae  Pterostylis                           NaN                  1\n1178  https://id.biodiversity.org.au/taxon/apni/5141...             Pterostylis multiflora     (D.L.Jones) G.N.Backh.    species   Plantae  Charophyta  Equisetopsida     Asparagales   Orchidaceae  Pterostylis  Mountain Brown-tip Greenhood                  1\n1179  https://id.biodiversity.org.au/taxon/apni/5141...            Pterostylis pedunculata                      R.Br.    species   Plantae  Charophyta  Equisetopsida     Asparagales   Orchidaceae  Pterostylis                    Maroonhood                  1\n1180  https://id.biodiversity.org.au/taxon/apni/5141...                Thelymitra ixioides                        Sw.    species   Plantae  Charophyta  Equisetopsida     Asparagales   Orchidaceae   Thelymitra             Dotted Sun Orchid                  1\n1181  https://id.biodiversity.org.au/taxon/ausmoss/1...                 Thuidiopsis sparsa  (Hook.f. & Wilson) Broth.    species   Plantae   Bryophyta      Bryopsida        Hypnales   Thuidiaceae  Thuidiopsis                           NaN                  1\n\n[1182 rows x 12 columns]\n```\n\n\n:::\n:::\n\n:::\n\n# Cross-reference with threatened and sensitive species lists\n\nNext we will compare our Yass valley species list with several state-wide conservation status lists of threatened and sensitive species. We can retrieve lists of threatened and sensitive species in one of two ways: <br>\n\n  - Use the lists available in the Atlas of Living Australia<br>\n  - Use your own list\n\nBoth use the same method of matching species names in our Yass Valley list to species names in official conservation status lists. However, there is a slightly different workflow between using `galah-python` and using an externally downloaded list. Choose from the options below to use either method.\n\n::: {.panel-tabset .nav-pills}\n\n# Using lists in the ALA\n\nWe can use `galah-python` to access lists that are available on the Atlas of Living Australia to compare to our Yass Valley species list. \n\nYass Valley is within the state of New South Wales, so let's do a text search for \"New South Wales\" to see what state-specific lists are available.\n\n\n::: {.cell}\n\n```{.python .cell-code}\ngalah.search_all(lists=\"New South Wales\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  species_list_uid                                listName           listType           dateCreated           lastUpdated          lastUploaded           lastMatched                   username fullName  itemCount           region category generalisation authority       sdsType  isAuthoritative  isInvasive  isThreatened looseSearch   wkt\n0            dr650   New South Wales : Conservation Status  CONSERVATION_LIST  2015-04-04T13:00:00Z  2023-06-07T23:12:20Z  2023-06-07T23:12:20Z  2023-06-07T23:12:20Z  rosemary.oconnor@csiro.au     None       1026  New South Wales     None           None      None          None             True       False          True        None  None\n1            dr487  New South Wales Sensitive Species List     SENSITIVE_LIST  2013-06-20T14:00:00Z  2023-08-30T01:54:47Z  2023-08-30T01:54:46Z  2023-08-30T01:54:46Z  rosemary.oconnor@csiro.au     None        203              NSW                           NSW OEH  CONSERVATION             True       False         False        None      \n```\n\n\n:::\n:::\n\n\nTwo lists are returned, and both appear relevant. With the help of some additional columns returned by `search_all()`—`listType`, `isAuthoritative` and `isThreatened`—we can learn more about which list suits our needs best. Although both lists are authoritative, only one list (`dr650`) contains threatened species whereas the other `dr487` contains sensitive species. \n\n\n::: {.cell}\n\n```{.python .cell-code}\ngalah.search_all(lists=\"New South Wales\")[[\"species_list_uid\", \"listType\", \"isAuthoritative\", \"isThreatened\"]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n  species_list_uid           listType  isAuthoritative  isThreatened\n0            dr650  CONSERVATION_LIST             True          True\n1            dr487     SENSITIVE_LIST             True         False\n```\n\n\n:::\n:::\n\n\nWe can return only species in Yass Valley on the New South Wales Conservation Status List (`dr650`) by adding the list ID `species_list_uid=dr650` to `filters`. Our query returns 22 species.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nyass_threatened = galah.atlas_species(\n  polygon=yass_valley[\"geometry\"][127],\n  filters=[\"year=2023\", \"species_list_uid=dr650\"],\n  counts=True\n  )\nyass_threatened\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                              Species                           Species Name Scientific Name Authorship Taxon Rank   Kingdom      Phylum          Class            Order           Family          Genus               Vernacular Name  Number of records\n0   https://biodiversity.org.au/afd/taxa/a3e5376b-...            Petroica (Petroica) boodang             (Lesson, 1838)    species  Animalia    Chordata           Aves    Passeriformes      Petroicidae       Petroica                 Scarlet Robin                 35\n1   https://biodiversity.org.au/afd/taxa/6c646af8-...               Callocephalon fimbriatum              (Grant, 1803)    species  Animalia    Chordata           Aves   Psittaciformes       Cacatuidae  Callocephalon            Gang-gang Cockatoo                 29\n2   https://biodiversity.org.au/afd/taxa/6e872b58-...  Stagonopleura (Stagonopleura) guttata               (Shaw, 1796)    species  Animalia    Chordata           Aves    Passeriformes      Estrildidae  Stagonopleura              Diamond Firetail                 20\n3   https://biodiversity.org.au/afd/taxa/b47a4ecd-...    Hieraaetus (Hieraaetus) morphnoides              (Gould, 1841)    species  Animalia    Chordata           Aves  Accipitriformes     Accipitridae     Hieraaetus                  Little Eagle                 13\n4   https://biodiversity.org.au/afd/taxa/8bf4b8b0-...   Daphoenositta (Neositta) chrysoptera             (Latham, 1801)    species  Animalia    Chordata           Aves    Passeriformes      Neosittidae  Daphoenositta               Varied Sittella                 12\n5   https://biodiversity.org.au/afd/taxa/fe74e658-...          Petroica (Littlera) phoenicea                Gould, 1837    species  Animalia    Chordata           Aves    Passeriformes      Petroicidae       Petroica                   Flame Robin                 12\n6    https://id.biodiversity.org.au/node/apni/2910323                 Ammobium craspedioides                     Benth.    species   Plantae  Charophyta  Equisetopsida        Asterales       Asteraceae       Ammobium                    Yass Daisy                  6\n7   https://biodiversity.org.au/afd/taxa/46fca72f-...                   Polytelis swainsonii          (Desmarest, 1826)    species  Animalia    Chordata           Aves   Psittaciformes      Psittacidae      Polytelis                 Superb Parrot                  5\n8   https://biodiversity.org.au/afd/taxa/d1c5dee0-...            Ninox (Rhabdoglaux) strenua              (Gould, 1838)    species  Animalia    Chordata           Aves     Strigiformes        Strigidae          Ninox                  Powerful Owl                  5\n9   https://id.biodiversity.org.au/taxon/apni/5129...                     Eucalyptus radiata              Sieber ex DC.    species   Plantae  Charophyta  Equisetopsida         Myrtales        Myrtaceae     Eucalyptus      Narrow-leaved Peppermint                  5\n10  https://biodiversity.org.au/afd/taxa/0aa4d63d-...                        Keyacris scurra               (Rehn, 1952)    species  Animalia  Arthropoda        Insecta       Orthoptera        Morabidae       Keyacris  Key's Matchstick Grasshopper                  4\n11  https://biodiversity.org.au/afd/taxa/2063bf6d-...        Pachycephala (Timixos) olivacea   Vigors & Horsfield, 1827    species  Animalia    Chordata           Aves    Passeriformes  Pachycephalidae   Pachycephala                Olive Whistler                  3\n12  https://biodiversity.org.au/afd/taxa/23c951c0-...                    Stictonetta naevosa              (Gould, 1841)    species  Animalia    Chordata           Aves     Anseriformes         Anatidae    Stictonetta                 Freckled Duck                  2\n13  https://biodiversity.org.au/afd/taxa/32f9229c-...                       Oxyura australis                Gould, 1837    species  Animalia    Chordata           Aves     Anseriformes         Anatidae         Oxyura              Blue-billed Duck                  2\n14  https://biodiversity.org.au/afd/taxa/c95af018-...      Epthianura (Epthianura) albifrons    (Jardine & Selby, 1828)    species  Animalia    Chordata           Aves    Passeriformes     Meliphagidae     Epthianura            White-fronted Chat                  2\n15  https://biodiversity.org.au/afd/taxa/dc420306-...    Haliaeetus (Pontoaetus) leucogaster             (Gmelin, 1788)    species  Animalia    Chordata           Aves  Accipitriformes     Accipitridae     Haliaeetus       White-bellied Sea-eagle                  2\n16  https://id.biodiversity.org.au/taxon/apni/5128...                  Leucochrysum albicans    (A.Cunn.) Paul G.Wilson    species   Plantae  Charophyta  Equisetopsida        Asterales       Asteraceae   Leucochrysum                           NaN                  2\n17  https://biodiversity.org.au/afd/taxa/0d74fa05-...                  Aprasia parapulchella                Kluge, 1974    species  Animalia    Chordata       Reptilia         Squamata      Pygopodidae        Aprasia       Pink-tailed Worm-lizard                  1\n18  https://biodiversity.org.au/afd/taxa/4cb195fd-...                      Lathamus discolor               (Shaw, 1790)    species  Animalia    Chordata           Aves   Psittaciformes      Psittacidae       Lathamus                  Swift Parrot                  1\n19  https://biodiversity.org.au/afd/taxa/5557cf29-...                     Litoria verreauxii           (DumÃ©ril, 1853)    species  Animalia    Chordata       Amphibia            Anura          Hylidae        Litoria               Verreaux's Frog                  1\n20  https://biodiversity.org.au/afd/taxa/7e891f26-...                     Petauroides volans               (Kerr, 1792)    species  Animalia    Chordata       Mammalia    Diprotodontia  Pseudocheiridae    Petauroides                Greater Glider                  1\n21  https://biodiversity.org.au/afd/taxa/a51dca29-...                          Synemon plana               Walker, 1854    species  Animalia  Arthropoda        Insecta      Lepidoptera       Castniidae        Synemon               Golden Sun Moth                  1\n22  https://biodiversity.org.au/afd/taxa/e9d6fbbd-...                 Phascolarctos cinereus           (Goldfuss, 1817)    species  Animalia    Chordata       Mammalia    Diprotodontia  Phascolarctidae  Phascolarctos                         Koala                  1\n```\n\n\n:::\n:::\n\n\nWe can do the same using the New South Wales Sensitive Species (`dr487`). Our query returns 3 species.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nyass_sensitive = galah.atlas_species(\n  polygon=yass_valley[\"geometry\"][127],\n  filters=[\"year=2023\", \"species_list_uid=dr487\"],\n  counts=True\n  )\nyass_sensitive\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                             Species                 Species Name Scientific Name Authorship Taxon Rank   Kingdom    Phylum Class           Order       Family          Genus     Vernacular Name  Number of records\n0  https://biodiversity.org.au/afd/taxa/6c646af8-...     Callocephalon fimbriatum              (Grant, 1803)    species  Animalia  Chordata  Aves  Psittaciformes   Cacatuidae  Callocephalon  Gang-gang Cockatoo                 29\n1  https://biodiversity.org.au/afd/taxa/46fca72f-...         Polytelis swainsonii          (Desmarest, 1826)    species  Animalia  Chordata  Aves  Psittaciformes  Psittacidae      Polytelis       Superb Parrot                  5\n2  https://biodiversity.org.au/afd/taxa/d1c5dee0-...  Ninox (Rhabdoglaux) strenua              (Gould, 1838)    species  Animalia  Chordata  Aves    Strigiformes    Strigidae          Ninox        Powerful Owl                  5\n```\n\n\n:::\n:::\n\n\n# Using external lists\n\nWe can use our own conservation status lists from an external source to compare to our Yass Valley species list. \n\nAs an example, we are using the the New South Wales Conservation Status List and the New South Wales Sensitive Species List[^3].\n\n\n{{< downloadthis ../data/example_TSL.csv label=\"Download Conservation Status List\" icon=database-fill-down type=info class=data-button >}} {{< downloadthis ../data/example_SSL.csv label=\"Download Sensitive Species List\" icon=database-fill-down type=info class=data-button >}}\n\n\n\n[^3]: These are the same two lists that you can access in `galah-python`, available from the Atlas of Living Australia. Keep in mind that if you use an external list, data cleaning may be required before matching species names.\n\nFirst, let's read in both lists and see what each list looks like.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nimport pandas as pd\nthreatened_list = pd.read_csv(\"example_TSL.csv\")\nsensitive_list = pd.read_csv(\"example_SSL.csv\")\n```\n:::\n\n::: {.cell}\n\n:::\n\n\nWe can use the `isin()` to return the names in `species_yass` that \nmatch names in `threatened_list`. We return 22 species.\n\n\n::: {.cell}\n\n```{.python .cell-code}\nyass_threatened = species_yass[species_yass['Species Name'].isin(list(threatened_list['species name']))].reset_index(drop=True)\nyass_threatened\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                              Species                           Species Name Scientific Name Authorship Taxon Rank   Kingdom      Phylum          Class            Order           Family          Genus           Vernacular Name  Number of records\n0   https://biodiversity.org.au/afd/taxa/a3e5376b-...            Petroica (Petroica) boodang             (Lesson, 1838)    species  Animalia    Chordata           Aves    Passeriformes      Petroicidae       Petroica             Scarlet Robin                 35\n1   https://biodiversity.org.au/afd/taxa/6c646af8-...               Callocephalon fimbriatum              (Grant, 1803)    species  Animalia    Chordata           Aves   Psittaciformes       Cacatuidae  Callocephalon        Gang-gang Cockatoo                 29\n2   https://biodiversity.org.au/afd/taxa/5557cf29-...                     Litoria verreauxii           (DumÃ©ril, 1853)    species  Animalia    Chordata       Amphibia            Anura          Hylidae        Litoria           Verreaux's Frog                 27\n3   https://biodiversity.org.au/afd/taxa/6e872b58-...  Stagonopleura (Stagonopleura) guttata               (Shaw, 1796)    species  Animalia    Chordata           Aves    Passeriformes      Estrildidae  Stagonopleura          Diamond Firetail                 20\n4   https://biodiversity.org.au/afd/taxa/b47a4ecd-...    Hieraaetus (Hieraaetus) morphnoides              (Gould, 1841)    species  Animalia    Chordata           Aves  Accipitriformes     Accipitridae     Hieraaetus              Little Eagle                 13\n5   https://biodiversity.org.au/afd/taxa/8bf4b8b0-...   Daphoenositta (Neositta) chrysoptera             (Latham, 1801)    species  Animalia    Chordata           Aves    Passeriformes      Neosittidae  Daphoenositta           Varied Sittella                 12\n6   https://biodiversity.org.au/afd/taxa/fe74e658-...          Petroica (Littlera) phoenicea                Gould, 1837    species  Animalia    Chordata           Aves    Passeriformes      Petroicidae       Petroica               Flame Robin                 12\n7    https://id.biodiversity.org.au/node/apni/2910323                 Ammobium craspedioides                     Benth.    species   Plantae  Charophyta  Equisetopsida        Asterales       Asteraceae       Ammobium                Yass Daisy                  6\n8   https://biodiversity.org.au/afd/taxa/46fca72f-...                   Polytelis swainsonii          (Desmarest, 1826)    species  Animalia    Chordata           Aves   Psittaciformes      Psittacidae      Polytelis             Superb Parrot                  5\n9   https://biodiversity.org.au/afd/taxa/d1c5dee0-...            Ninox (Rhabdoglaux) strenua              (Gould, 1838)    species  Animalia    Chordata           Aves     Strigiformes        Strigidae          Ninox              Powerful Owl                  5\n10  https://id.biodiversity.org.au/taxon/apni/5129...                     Eucalyptus radiata              Sieber ex DC.    species   Plantae  Charophyta  Equisetopsida         Myrtales        Myrtaceae     Eucalyptus  Narrow-leaved Peppermint                  5\n11  https://id.biodiversity.org.au/taxon/apni/5128...                  Leucochrysum albicans    (A.Cunn.) Paul G.Wilson    species   Plantae  Charophyta  Equisetopsida        Asterales       Asteraceae   Leucochrysum                       NaN                  4\n12  https://biodiversity.org.au/afd/taxa/2063bf6d-...        Pachycephala (Timixos) olivacea   Vigors & Horsfield, 1827    species  Animalia    Chordata           Aves    Passeriformes  Pachycephalidae   Pachycephala            Olive Whistler                  3\n13  https://biodiversity.org.au/afd/taxa/23c951c0-...                    Stictonetta naevosa              (Gould, 1841)    species  Animalia    Chordata           Aves     Anseriformes         Anatidae    Stictonetta             Freckled Duck                  2\n14  https://biodiversity.org.au/afd/taxa/32f9229c-...                       Oxyura australis                Gould, 1837    species  Animalia    Chordata           Aves     Anseriformes         Anatidae         Oxyura          Blue-billed Duck                  2\n15  https://biodiversity.org.au/afd/taxa/c95af018-...      Epthianura (Epthianura) albifrons    (Jardine & Selby, 1828)    species  Animalia    Chordata           Aves    Passeriformes     Meliphagidae     Epthianura        White-fronted Chat                  2\n16  https://biodiversity.org.au/afd/taxa/dc420306-...    Haliaeetus (Pontoaetus) leucogaster             (Gmelin, 1788)    species  Animalia    Chordata           Aves  Accipitriformes     Accipitridae     Haliaeetus   White-bellied Sea-eagle                  2\n17  https://biodiversity.org.au/afd/taxa/0d74fa05-...                  Aprasia parapulchella                Kluge, 1974    species  Animalia    Chordata       Reptilia         Squamata      Pygopodidae        Aprasia   Pink-tailed Worm-lizard                  1\n18  https://biodiversity.org.au/afd/taxa/4cb195fd-...                      Lathamus discolor               (Shaw, 1790)    species  Animalia    Chordata           Aves   Psittaciformes      Psittacidae       Lathamus              Swift Parrot                  1\n19  https://biodiversity.org.au/afd/taxa/7e891f26-...                     Petauroides volans               (Kerr, 1792)    species  Animalia    Chordata       Mammalia    Diprotodontia  Pseudocheiridae    Petauroides            Greater Glider                  1\n20  https://biodiversity.org.au/afd/taxa/a51dca29-...                          Synemon plana               Walker, 1854    species  Animalia  Arthropoda        Insecta      Lepidoptera       Castniidae        Synemon           Golden Sun Moth                  1\n21  https://biodiversity.org.au/afd/taxa/e9d6fbbd-...                 Phascolarctos cinereus           (Goldfuss, 1817)    species  Animalia    Chordata       Mammalia    Diprotodontia  Phascolarctidae  Phascolarctos                     Koala                  1\n```\n\n\n:::\n:::\n\n\nWe can do the same with `sensitive_list`, which returns 3 species.\n\n::: {.cell}\n\n```{.python .cell-code}\nyass_sensitive =  species_yass[species_yass['Species Name'].isin(list(sensitive_list['species name']))].reset_index(drop=True)\nyass_sensitive\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n                                             Species                 Species Name Scientific Name Authorship Taxon Rank   Kingdom    Phylum Class           Order       Family          Genus     Vernacular Name  Number of records\n0  https://biodiversity.org.au/afd/taxa/6c646af8-...     Callocephalon fimbriatum              (Grant, 1803)    species  Animalia  Chordata  Aves  Psittaciformes   Cacatuidae  Callocephalon  Gang-gang Cockatoo                 29\n1  https://biodiversity.org.au/afd/taxa/46fca72f-...         Polytelis swainsonii          (Desmarest, 1826)    species  Animalia  Chordata  Aves  Psittaciformes  Psittacidae      Polytelis       Superb Parrot                  5\n2  https://biodiversity.org.au/afd/taxa/d1c5dee0-...  Ninox (Rhabdoglaux) strenua              (Gould, 1838)    species  Animalia  Chordata  Aves    Strigiformes    Strigidae          Ninox        Powerful Owl                  5\n```\n\n\n:::\n:::\n\n\n:::\n\n# Visualise species conservation status\n\nOne useful way to visualise the number of threatened and sensitive species in an area is using a waffle chart. Waffle charts are useful because they can show the total number of species (represented as individual square units) and proportions of different groups (represented by colours). \n\nFor example, we can visualse the number and proportion of species with different conservation status, along with a taxonomic breakdown of threatened/sensitive species [^4].\n\n[^4]: To create our colour palette, we used [David Nichol's website](https://davidmathlogic.com/colorblind/#%23EAEAD8-%231E88E5-%23F7E9C3-%2324DCBD-%2343006B) to help colours that are colour-blind friendly, [the ColorHexa website](https://www.colorhexa.com/43006b-to-eaead8) create a gradient between 2 colours, and [Coolors](https://coolors.co/) to adjust the colours & shades.\n\n\n::: {.cell}\n\n```{.python .cell-code  code-fold=\"true\"}\n# add packages\nimport matplotlib \nimport matplotlib.pyplot as plt\nfrom pywaffle import Waffle \n\n# initialise figure\nfig = plt.figure(figsize=(10,6))\nfig.add_subplot(211) # Top Long Waffle Chart #211\nfig.add_subplot(212) # Bottom Left Sensitive/Threatened # 223\n\n# set the axes for separate plotting\nax1, ax2 = fig.axes\n\n# # Modify existing axis and set aspect to equal\nax1.set_aspect(aspect=\"equal\")\nax2.set_aspect(aspect=\"equal\")\n\n# make sure there are unique colours for each species\nremaining_species = species_yass.shape[0] - (yass_sensitive.shape[0] + yass_threatened.shape[0])\nall_species = [yass_sensitive.shape[0],yass_threatened.shape[0],remaining_species]\n\n# add title over all plots\nplt.suptitle(\"Species in Yass Valley in 2023\",fontsize=20)\n\n# add extra text\npercentage = round(float(yass_sensitive.shape[0] + yass_threatened.shape[0]) / species_yass.shape[0], 4)*100\nfig.text(0.56,0.44,\"*1 square = 1 species\",fontsize=12)\nfig.text(0.56,0.22,\"{}%\".format(percentage),fontsize=56)\nfig.text(0.56,0.18,\"Threatened/Sensitive Species\",fontsize=12)\nfig.text(0.13,0.50,\"Taxonomic Breakdown\",fontsize=13)\n\n# waffle chart\nWaffle.make_waffle(\n    ax=ax1,\n    rows=15,\n    values=all_species, \n    colors = [\"#FFC547\",\"#A12B58\",\"#E1E1E1\"],\n    legend={\n        'labels': [\"Sensitive\",\"Threatened\",\"Remaining\"],\n        'loc': 'upper left',\n        'bbox_to_anchor': (0.23, 1.2),\n        'ncol': 3,\n        'framealpha': 0,\n        'fontsize': 10\n    }\n)\n\n# separate into birds, mammals, reptiles, plants and other\nbirds = yass_sensitive[yass_sensitive[\"Class\"] == \"Aves\"].shape[0] + yass_threatened[yass_threatened[\"Class\"] == \"Aves\"].shape[0]\nmammals = yass_sensitive[yass_sensitive[\"Class\"] == \"Mammalia\"].shape[0] + yass_threatened[yass_threatened[\"Class\"] == \"Mammalia\"].shape[0]\nreptiles = yass_sensitive[yass_sensitive[\"Class\"] == \"Reptilia\"].shape[0] + yass_threatened[yass_threatened[\"Class\"] == \"Reptilia\"].shape[0]\nplants = yass_sensitive[yass_sensitive[\"Kingdom\"] == \"Plantae\"].shape[0] + yass_threatened[yass_threatened[\"Kingdom\"] == \"Plantae\"].shape[0]\nother = (yass_sensitive.shape[0] + yass_threatened.shape[0]) - (birds + mammals + reptiles + plants)\n\n# get counts and add them to labels\ngroup_count = [birds,mammals,reptiles,plants,other]\n\n# make the labels with number of unique species in label\ngroup_labels = [\"Birds\",\"Mammals\",\"Reptiles\",\"Plants\",\"Other\"]\n\n# Make types breakdown waffle chart\nWaffle.make_waffle(\n    ax=ax2,\n    rows=5,\n    values=group_count, \n    colors = [\"#68116A\",\"#A72566\",\"#CA3F51\",\"#DE9568\",\"#F2D0A6\"],\n    legend={\n        'labels': group_labels,\n        'loc': 'upper right',\n        'bbox_to_anchor': (1.7, 1.02),\n        'ncol': 1,\n        'framealpha': 0,\n        'fontsize': 10\n    }\n)\n```\n:::\n\n::: {.cell .column-page layout-align=\"center\" lightbox='{\"group\":\"final-plot\"}'}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-23-1.png){fig-align='center' width=9in style=margin-left:auto;margin-right:auto;}\n:::\n:::\n\n\n# Final thoughts\n\nWe hope this post has helped you understand how to download a species list for a specific area and compare it to conservation lists. It's also possible to compare species with other information like lists of migratory species or seasonal species.\n\nFor other Python posts, check out [our beginner's guide to map species observations](https://labs.ala.org.au/posts/2023-12-18_beginners-guide-make-a-map/index.html) or see [how to map distributions of invasive species](https://labs.ala.org.au/posts/2023-04-28_plotting-invasive-species/post.html).\n\n<details><summary style = \"color: #E06E53;\">Expand for session info</summary>\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n-----\ngalah               0.8.2\ngeopandas           0.14.1\nmatplotlib          3.8.2\nnatsort             8.4.0\npandas              2.1.3\npywaffle            NA\nsession_info        1.0.0\n-----\nPython 3.12.0 (tags/v3.12.0:0fb18b0, Oct  2 2023, 13:03:39) [MSC v.1935 64 bit (AMD64)]\nWindows-10-10.0.19045-SP0\n-----\nSession information updated at 2024-02-16 12:28\n```\n\n\n:::\n:::\n\n\n</details>\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}